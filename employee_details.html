<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personel Detayları</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="mySidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Panel</h2>
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        </div>
        <a href="admin.html">Ana Sayfa</a>
        <a href="employees.html">Personel</a>
        <a href="reports.html">Raporlar</a>
        <a href="downloads.html">İndirmeler</a>
        <a href="#" onclick="auth.logout()">Çıkış Yap</a>
    </div>

    <!-- ... existing main content ... -->

    <script src="app.js"></script>
    <script>
        auth.check();
        if (auth.getRole() !== 'admin') window.location.href = 'login.html';

        // ... (nav functions) ...

        async function loadDetails() {
            // ... (existing ID check) ...
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if (!id) { window.location.href = 'admin.html'; return; }

            const res = await apiFetch(`/admin/employee/${id}`);
            if (!res.ok) { alert("Personel bulunamadı"); window.location.href = 'admin.html'; return; }

            const data = await res.json();
            document.getElementById('empNameTitle').textContent = data.full_name;
            document.getElementById('empUsername').textContent = data.user_name;

            let html = `<table>
                <thead>
                    <tr>
                        <th>Hesap Adı</th>
                        <th>Şifre</th>
                        <th>Link</th>
                        <th>İşlem</th>
                    </tr>
                </thead>
                <tbody>`;

            if (data.assigned_accounts.length === 0) {
                html += '<tr><td colspan="4" style="text-align:center; color:#6b7280;">Atanmış hesap yok.</td></tr>';
            } else {
                data.assigned_accounts.forEach(acc => {
                    html += `<tr>
                        <td><strong>${acc.username}</strong></td>
                        <td style="font-family:monospace; background:#f3f4f6; padding:4px 8px; border-radius:4px;">${acc.password || '-'}</td>
                        <td>
                            <a href="https://www.instagram.com/${acc.username}/" target="_blank" 
                               style="background-color:#E1306C; color:white; padding:6px 12px; border-radius:4px; text-decoration:none; font-size:0.9em; display:inline-block;">
                               Instagram'a Git &nearr;
                            </a>
                        </td>
                        <td>
                             <button onclick="deleteAccount(${acc.id})" style="width: auto; background-color: #ef4444; font-size: 0.8em; padding: 6px 12px;">Sil</button>
                        </td>
                    </tr>`;
                });
            }

            html += `</tbody></table>`;
            document.getElementById('accountList').innerHTML = html;
        }

        async function deleteAccount(accId) {
            if (!confirm("Bu hesap silinsin mi? (Geri alınamaz)")) return;

            const res = await apiFetch(`/admin/instagram-account/${accId}`, {
                method: 'DELETE'
            });

            if (res.ok) {
                // Reload details to refresh list
                loadDetails();
            } else {
                alert("Silme hatası");
            }
        }

        function openNav() {
            document.getElementById("mySidebar").classList.add("open");
        }

        function closeNav() {
            document.getElementById("mySidebar").classList.remove("open");
        }

        loadDetails();
    </script>
</body>

</html>